<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gymkhana Cumple üéÅ</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --text:#e8ecff; --muted:#a7b0d6;
      --accent:#7c5cff; --good:#2dd4bf; --bad:#fb7185; --line:#243055;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background: radial-gradient(1200px 700px at 20% 10%, #1a2450 0%, var(--bg) 55%);
      color:var(--text);
      min-height:100vh; display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .wrap{width:min(920px, 100%); display:grid; gap:16px;}
    .top{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:14px 16px; border:1px solid var(--line); border-radius:16px;
      background: color-mix(in oklab, var(--card) 92%, transparent);
      backdrop-filter: blur(8px);
    }
    .title{display:flex; flex-direction:column; gap:4px;}
    .title h1{margin:0; font-size:18px;}
    .title p{margin:0; color:var(--muted); font-size:13px;}
    .progress{
      display:flex; align-items:center; gap:10px;
      min-width:260px;
    }
    .bar{
      flex:1; height:10px; border-radius:999px; background:#0c1431;
      border:1px solid var(--line); overflow:hidden;
    }
    .bar > div{height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--good));}
    .pill{
      font-size:12px; color:var(--muted);
      border:1px solid var(--line); padding:6px 10px; border-radius:999px;
    }

    .card{
      border:1px solid var(--line); border-radius:18px;
      background: color-mix(in oklab, var(--card) 94%, transparent);
      padding:18px;
    }
    .card h2{margin:0 0 8px 0; font-size:16px;}
    .card p{margin:0 0 14px 0; color:var(--muted); line-height:1.45;}
    .row{display:flex; gap:10px; flex-wrap:wrap;}
    input{
      flex:1; min-width:220px;
      background:#0c1431; border:1px solid var(--line); color:var(--text);
      border-radius:12px; padding:12px 12px; outline:none;
    }
    input:focus{border-color: color-mix(in oklab, var(--accent) 70%, var(--line));}
    button{
      border:none; border-radius:12px; padding:12px 14px;
      background:var(--accent); color:white; font-weight:600; cursor:pointer;
    }
    button.secondary{background:#0c1431; border:1px solid var(--line); color:var(--text);}
    button:active{transform: translateY(1px);}
    .msg{margin-top:12px; font-size:13px; color:var(--muted);}
    .msg.good{color:var(--good);}
    .msg.bad{color:var(--bad);}

    .grid{
      display:grid; grid-template-columns: 1fr; gap:16px;
    }
    @media (min-width: 860px){
      .grid{grid-template-columns: 1.3fr 0.7fr;}
    }
    .steps{display:grid; gap:10px;}
    .step{
      padding:12px 12px; border-radius:14px;
      border:1px solid var(--line); background:#0c1431;
      display:flex; align-items:center; justify-content:space-between;
      font-size:13px;
    }
    .badge{
      font-size:12px; padding:4px 8px; border-radius:999px;
      border:1px solid var(--line); color:var(--muted);
    }
    .badge.done{border-color: color-mix(in oklab, var(--good) 60%, var(--line)); color:var(--good);}
    .badge.lock{border-color: color-mix(in oklab, var(--bad) 55%, var(--line)); color:var(--bad);}
    .final{
      border:1px dashed color-mix(in oklab, var(--good) 55%, var(--line));
      background: color-mix(in oklab, var(--card) 85%, transparent);
    }
    .small{font-size:12px; color:var(--muted);}
    a{color:var(--good);}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="title">
        <h1>Gymkhana de Cumple üéâ</h1>
        <p>Completa las pruebas para desbloquear el regalo final.</p>
      </div>
      <div class="progress">
        <div class="bar"><div id="barFill"></div></div>
        <div class="pill" id="pill">0/4</div>
      </div>
    </div>

    <div class="grid">
      <div class="card" id="stageCard">
        <!-- Se rellena por JS -->
      </div>

      <div class="card">
        <h2>Mapa de la gymkhana</h2>
        <p class="small">Tip: si quieres ‚Äúpistas f√≠sicas‚Äù, haz que cada prueba te mande a una ubicaci√≥n real (cocina, sal√≥n, parque‚Ä¶).</p>
        <div class="steps" id="stepsList"></div>

        <div style="margin-top:14px" class="row">
          <button class="secondary" id="resetBtn">Reiniciar</button>
          <button class="secondary" id="skipBtn" title="Por si te atascas">Pista</button>
        </div>
        <div class="msg" id="hintMsg"></div>
      </div>
    </div>
  </div>

<script>
  // ‚úÖ PERSONALIZA AQU√ç TUS PRUEBAS
  const stages = [
    {
      title: "Prueba 1 ‚Äî La fecha",
      text: "Introduce un c√≥digo relacionado con una fecha especial (por ejemplo: el d√≠a que os conocisteis). Formato sugerido: DDMM.",
      placeholder: "Ej: 1206",
      answer: "1206", // <-- CAMBIA ESTO
      hint: "Pista: es una fecha que siempre recuerdas üòâ"
    },
    {
      title: "Prueba 2 ‚Äî Adivina la canci√≥n",
      text: "Pon la palabra clave de vuestra canci√≥n (puede ser el t√≠tulo o una palabra que se repita).",
      placeholder: "Ej: aventura",
      answer: "aventura", // <-- CAMBIA ESTO (min√∫sculas)
      hint: "Pista: la canci√≥n que te hace pensar en m√≠."
    },
    {
      title: "Prueba 3 ‚Äî Coordenadas caseras",
      text: "Busca una nota escondida en casa. En la nota habr√° un c√≥digo de 4 letras. Escr√≠belo aqu√≠.",
      placeholder: "Ej: LUNA",
      answer: "LUNA", // <-- CAMBIA ESTO (respeta may√∫sculas si quieres)
      hint: "Pista: mira donde guardas algo que usas a diario."
    },
    {
      title: "Final ‚Äî Regalo üéÅ",
      text: "¬°Lo lograste! Aqu√≠ va tu premio final:",
      final: true,
      giftHtml: `
        <ul>
          <li><strong>Tu regalo:</strong> Una cena sorpresa + tu postre favorito üç∞</li>
          <li><strong>Fecha:</strong> Cuando t√∫ elijas</li>
          <li><strong>Extra:</strong> Vale por un abrazo infinito ü´Ç</li>
        </ul>
        <p class="small">Si quieres, aqu√≠ puedes poner un link (Drive/Spotify/Canva) o una foto.</p>
      `
    }
  ];

  // Estado en localStorage
  const KEY = "bday_gymkhana_progress_v1";
  const state = JSON.parse(localStorage.getItem(KEY) || "{}");
  let current = Number.isFinite(state.current) ? state.current : 0;

  const stageCard = document.getElementById("stageCard");
  const stepsList = document.getElementById("stepsList");
  const barFill = document.getElementById("barFill");
  const pill = document.getElementById("pill");
  const resetBtn = document.getElementById("resetBtn");
  const skipBtn = document.getElementById("skipBtn");
  const hintMsg = document.getElementById("hintMsg");

  function save(){
    localStorage.setItem(KEY, JSON.stringify({ current }));
  }

  function normalize(s){
    return (s ?? "").trim();
  }

  function renderSteps(){
    stepsList.innerHTML = "";
    stages.forEach((s, idx) => {
      const el = document.createElement("div");
      el.className = "step";
      const left = document.createElement("div");
      left.textContent = s.final ? "üéÅ Regalo final" : `üß© ${s.title}`;
      const badge = document.createElement("div");
      badge.className = "badge";

      if (idx < current) { badge.textContent = "Hecho"; badge.classList.add("done"); }
      else if (idx === current) { badge.textContent = "Actual"; }
      else { badge.textContent = "Bloqueado"; badge.classList.add("lock"); }

      el.appendChild(left);
      el.appendChild(badge);
      stepsList.appendChild(el);
    });
  }

  function renderProgress(){
    const total = stages.length - 1; // sin contar el final como "prueba"
    const done = Math.min(current, total);
    const pct = Math.round((done / total) * 100);
    barFill.style.width = pct + "%";
    pill.textContent = `${done}/${total}`;
  }

  function renderStage(){
    hintMsg.textContent = "";
    hintMsg.className = "msg";

    const s = stages[current];

    if (!s) {
      current = stages.length - 1;
      save();
      return renderStage();
    }

    // Final
    if (s.final) {
      stageCard.classList.add("final");
      stageCard.innerHTML = `
        <h2>${s.title}</h2>
        <p>${s.text}</p>
        <div class="card" style="background:#0c1431;border:1px solid var(--line); border-radius:14px; padding:14px;">
          ${s.giftHtml}
        </div>
        <div class="row" style="margin-top:14px;">
          <button class="secondary" id="replayBtn">Volver a jugar</button>
        </div>
      `;
      document.getElementById("replayBtn").onclick = () => {
        current = 0; save();
        stageCard.classList.remove("final");
        renderAll();
      };
      renderSteps();
      renderProgress();
      return;
    }

    stageCard.classList.remove("final");
    stageCard.innerHTML = `
      <h2>${s.title}</h2>
      <p>${s.text}</p>
      <div class="row">
        <input id="answerInput" placeholder="${s.placeholder}" autocomplete="off" />
        <button id="checkBtn">Comprobar</button>
      </div>
      <div class="msg" id="msg"></div>
      <p class="small" style="margin-top:10px;">Consejo: puedes esconder pistas reales y usar esta web solo como ‚Äúcandado‚Äù.</p>
    `;

    const input = document.getElementById("answerInput");
    const msg = document.getElementById("msg");
    const check = () => {
      const val = normalize(input.value);

      // Comparaci√≥n: si la respuesta esperada tiene letras y es min√∫scula, comparamos en min√∫sculas.
      let ok = false;
      if (typeof s.answer === "string") {
        if (s.answer === s.answer.toLowerCase()) ok = val.toLowerCase() === s.answer;
        else ok = val === s.answer;
      }

      if (ok) {
        msg.textContent = "¬°Correcto! Desbloqueando la siguiente prueba‚Ä¶ ‚úÖ";
        msg.className = "msg good";
        current += 1;
        save();
        setTimeout(renderAll, 550);
      } else {
        msg.textContent = "Mmm‚Ä¶ no es. Prueba otra vez üòà";
        msg.className = "msg bad";
      }
    };

    document.getElementById("checkBtn").onclick = check;
    input.addEventListener("keydown", (e) => { if (e.key === "Enter") check(); });

    renderSteps();
    renderProgress();
  }

  function renderAll(){
    renderStage();
    renderSteps();
    renderProgress();
  }

  resetBtn.onclick = () => {
    current = 0;
    save();
    renderAll();
  };

  skipBtn.onclick = () => {
    const s = stages[current];
    if (!s || s.final) {
      hintMsg.textContent = "Ya est√°s en el final üéÅ";
      return;
    }
    hintMsg.textContent = s.hint || "Sin pista para esta prueba.";
    hintMsg.className = "msg";
  };

  renderAll();
</script>
</body>
</html>
